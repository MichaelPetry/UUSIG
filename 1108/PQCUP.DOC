RIGHTM ONSUBHDG NSUBHDG C,***   PQCUP 1R1   ***1'PQCUP' (Print Queue Clean-Up)2Introduction    The PQCUP processor is used to maintain the symbiont queues on your system. The main reason PQCUP has been written is to selectively get rid of print files which have been queued for printing but are no longer required.SPACE Please report any problems or suggestions to:SPACE                      Erich Staubringer               Email: gestau1@mvmhp.ciw.uni-karlsruhe.de               Fax:   xx49 7246/9420942Processor Call The general PQCUP processor call syntax is:SPACE @[<file.>]PQCUP[,<options>]  [<primary sel. specs>],[<secondary sel. specs>]SPACE As the above syntax indicates, all options and specification fields are optional and will have default values assigned, if necessary.SPACE The various specification fields are described in the following subsections.3File This is the file in which PQCUP is stored and is not required to be specified if PQCUP has been installed and registered in a system library file.3Options Options can be categorized into the following three groups:SPACE General options:0----------------SPACECOLUMN 10   C  -  Do not error terminate, even if an error occurs.         This applies to non-internal and non-serious errors         only.SPACE   Z  -  If debugging is enabled within the program, this option         produces diagnostic dumps at several key points in         the program. If debugging is disabled this option is         invalid.SPACE Action options:0---------------SPACE   D  -  Delete the selected print files. When this option is used         the J-option is assumed, if not specified.SPACE   L  -  List the selected print file entries. This is the default         option if no other action option has been specified.SPACE   U  -  Update (toggle) the In-Progress and/or SV bit of the selected         entries.         This option requires at least one of the selection option and         produces two lines of output per entry. The first line displays         the original entry (before the change) and the second line         displays the updated entry (after the change).SPACE Selection options:0------------------SPACE   I  -  Select entries with the In-Progress bit set only.SPACE   J  -  Bypass entries with the In-Progress bit set.SPACE   S  -  Select entries with the SV bit set only.SPACE   T  -  Bypass entries with the SV bit set.SPACECOLUMN 2 When more than one of the selection options are given, all tests must pass for the entry to be selected, provided it is a legal option combination (logical 'AND' operations are done).3Specification Fields The specification fields are used to specify further selection criteria for print files to be searched for. Two types of specification fields are available: Primary selection specifications and secondary selection specifications. If neither selection options nor specification fields are given, PQCUP defaults to all print files queued on the system.4Primary Selection Specifications Primary selection specs are the parameters which PQCUP passes on to the operating system and, in turn, retrieves only the entries which match the specified criteria. The format is:SPACE         <name>/<identifier>SPACE where:  name         refers to an EXEC entity of the following identifierSPACE         identifier   describes the name above and can be:SPACE0                     QUEUE       Print queue identifier0                     RUNID       Generated runid0                     USERID      Userid0                     OUTPUT-ID   Output-id of in-progress print files0                     PRIORITY    Priority value (A - Z)0                     FILE        File nameSPACE The above described identifiers can be abbreviated to any length. On the first specification field it can be omitted and defaults to QUEUE or FILE, respectively. This has been implemented to allow easy access to various print queues (@PQCUP B12, for example).SPACE All of the specified identifiers must match for an entry to be selected (logical 'AND' operations are done). The only exception to this rule is when multiple print queue ids have been specified to be searched. In this case, only one of the queue ids must match. The actual number of allowed print queue id specs is configurable and is currently set to a maximum of 10.SPACE If the identifier is RUNID or OUTPUT-ID and name is not specified, the generated runid of the calling run is assumed.SPACE If the identifier refers to a userid and name is omitted, the current userid is substituted.SPACE When the qualifier part of a file name is not specified, the run's default qualifier is used (@QUAL,D).SPACE When the qualifier is omitted but an asterisk precedes the filename the run's implied qualifier is used (@QUAL).SPACE When the file cycle is omitted the first print file found on the queue(s) which match the specified qualifier and file name is selected, regardless of the actual file cycle.SPACE Summarizing the rules outlined above gives the following sytax:SPACE0                       [<device-1>[/QUEUE],[<device-n>/QUEUE]],;0                       [[<run-id>]/RUNID],;0                       [[<user-id>]/USERID],;0                       [[<output-id>]/OUTPUT-ID],;0                       [<priority>/PRIORITY],;0                       [<qual>[*]]<file>[(cyc)].[/FILE]4Secondary Selection Specifications Secondary selection specs are selection parameters not supported by the operating system directly. Thus, PQCUP retrieves the entries specified via the primary selection specs and re-selects the desired entries.SPACE This specification, if used, must be the last field on the processor call line. If this is the only field, it must be made unique by using the test-operator or date identifier field, otherwise it would be recognized as a primary spec field print queue or file name.SPACE Currently, only one secondary selection spec is implemented which allows to select files based on their relative age. The specification field format is:SPACE                        [<test-operator>.][<relative age>][/<date ident>]SPACECOLUMN 25 where:  test-operator  is an optional field used to specify the test to                        be done against the relative age specification,                        which selects the files based on the number of                        days since catalogued or number of days last                        referenced, respectively.SPACE                        Valid test operators are:SPACE0                       TGE   (Test Greater or Equal)0                       TG    (Test Greater)0                       TE    (Test Equal)0                       TNE   (Test Not Equal)0                       TLE   (Test Less than or Equal)0                       TNG   (Test Not Greater)SPACE                        If this specification is omitted TGE is assumed,                        which causes all file entries to be selected                        older than or equal to the number of days                        specified in the relative age specification                        field.SPACE           relative age specifies the relative age in days of file                        entries to be selected.                        It can be omitted with the LIST function only                        and defaults to 0 in this case. For all other                        functions this specification is mandatory.                        The test to be performed depends on the                        test-operator specification described above.SPACE            date ident  specifies which date to use to determine the                        print file's age.SPACE                        Print files put on a symbiont queue do not have a field                        attached which tells the date the file has been symmed.                        To work around this gap, PQCUP offers the capability to                        refer either to the date the file has been catalogued or                        the last reference date of the file to determine it's                        relative age.SPACE                        Valid choices for this field are CATAGE or REFAGE.                        When it's not specified, CATAGE is the default.SPACE                        See section "Restrictions" for further details                        on this subject.COLUMN 22Current Restrictions and Limitations3Maximum Number Of Print Queue Entries Due to current (44R3) Exec limitations, PQCUP can only handle up to 169 print queue entries at most. However, when the D-option is used to delete entries, it could be possible for PQCUP to process all entries on a queue, even if there are more than 169 entries queued. Actually, the degree of success depends on the primary selection specs, i.e. the matching of the file entries against the user's specifications.SPACE Suppose there are 300 entries on a symbiont queue. PQCUP reads the first 169 entries and examines each one to determine which ones match the user-specified selection criteria. Let's assume that there have been 3 entries selected for deletion. When these entries have been successfully removed PQCUP recognizes that there are more entries queued and initiates another read request to retrieve the first 169 entries again. If the queue has not been changed by any other activity, there are 3 new entries in the set of the first 169 entries. The other 166 ones have already been read in the previous execution path.SPACE The user should be aware though that this processing is very inefficient, it does allow the removal of more than 169 print files, provided there is at least one entry which matches the primary selection specification.3Date Of @SYM The Exec does not carry the date a file has been symmed along with the symbiont queue entries, so it's not possible to refer to the date a file has been symmed. To get around this gap, PQCUP refers to the date the file has been catalogued. Optionally, this default value can be overwritten to refer to the last reference date of the file. However, using the last-reference date it should be remembered that if a user referenced the file while DLOC$-privileged, the file's last-reference date is not updated.2Notes3Changes To The System Clock When PQCUP executes and a date change occurs (either manually initiated or automatically at midnight), PQCUP continues to use the date it has been invoked to determine the relative dates of the print files.0In other words, the date used as a basis to calculate the relative date is determined at program initialization and subsequently re-used.3The Sign-Off Line When PQCUP terminates, it normally displays a sign-off line in the following format:SPACE   END PQCUP.  Examined: a/b   Listed: c  Changed: d  Deleted: e  Rejected: fSPACECOLUMN 25   where:      a        Number of entries returned by the operating system                        on the LAST retrieve operation.SPACE               b        Total number of entries at the time of the LAST                        retrieve operation.SPACE               c        The number of files that have been listed, i. e.                        displayed.SPACE               d        The number of entries updated.SPACE               e        The number of entries removed.SPACE               f        The number of entries that have not been processed                        due to any of the following errors encountered:SPACE0                       -  An error occured reading the MFD information of a file0                       -  The In-progress bit could not be set for an entry0                       -  The entry could not be removed0                       -  The Exec marked the entry in errorCOLUMN 2SPACE When a file is marked rejected or any other unusual situation is encountered a snapshot dump and/or formatted dump is displayed, depending on the type of error.3System Log Entries For Deleted Print Files When a print file is being dropped via ER SMOQUE$, the Exec assigns it to it's PCT and finally marks it for deletion. Therefore, Exec is recorded in the system log file entry as the deleting activity, regardless of the initiator. Unfortunately, there is no way to determine the originating activity which actually initiated the delete request.SPACE I have opened a Feature Suggestion on this subject, but haven't received an answer yet.3Privileges And File Security To access, modify and delete print files PQCUP uses various ER SMOQUE$ functions. Access to some of these functions is restricted, and only users with appropriate privileges can use them. The type of required privileges depends on the system configuration:SPACE On systems running Fundamental Security only the security officer has the rights to use privileged ER SMOQUE$ functions.SPACE On systems with Secopt-1 or higher turned on the calling user has to have the SSSMOQUE privilege to use the privileged ER SMOQUE$ functions. The security officer grants these privileges to individual users.SPACE However, a user with access to the privileged ER SMOQUE$ functions bypasses all file security checks. Even in a Secopt-1 or higher system, delete access is granted to ALL files, not only to the files within the user's compartment set or clearance level range, as one might assume.SPACE I have opened a Feature Suggestion on this subject, but haven't received an answer yet.2Planned Enhancements For Future Releases - Detailed and meaningful messages on spec field errorsSPACE - Attach use-names to the selected print files (if no D-option)SPACE - Copy / move the selected files into program file elements2Release History - Sep '95   1R1    Initial release2Examples Each of the following examples shows at least two possible PQCUP calls. The first one shows the full spelled out syntax, and any following calls are abbreviated calls which deliver the same results. Additionally, all examples assume that PQCUP has been either installed in a system library file or copied into the run's TPF$ file.SPACE 2  List all print files on the system.SPACE           @PQCUP,L   TGE.0/CATAGE           @PQCUPSPACE 2 List all print files on the system on queue B12 which have been created 30 days or longer ago.SPACE           @PQCUP,L   B12/QUEUE,TGE.30/CATAGE           @PQCUP     B12/Q,TGE.30           @PQCUP     B12,30SPACE 2 Delete all print files on the system which have been symmed by the current userid and have not been referenced for at least 30 days.SPACE           @PQCUP,D   /USERID,TGE.30/REFAGE           @PQCUP,D   /USER,30/REFAGE           @PQCUP,D   /U,30/REFAGESPACE 2 Delete all print files created by the user-id currently executing under which are catalogued 3 days before and have the SV-bit set, i. e. have been saved to tape via the SV keyin and the N-option.SPACE           @PQCUP,DS  /USERID,TE.3/CATAGE           @PQCUP,DS  /U,TE.3SPACE 2 Same scenario as above, but clear the SV-bit rather than deleting the files.SPACE           @PQCUP,US  /USERID,TE.3/CATAGE           @PQCUP,US  /U,TE.3SPACE 2 Delete all print files created by run SYSGEO which have been saved to tape but not removed from the symbiont queues (via SV ,/N) and have not been referenced within the last 7 days.SPACE           @PQCUP,DS   SYSGEO/RUNID,TGE.7/REFAGE           @PQCUP,DS   SYSGEO/R,7/REFAGESPACE 2 Clear the IP bit of all files on queues B12 and B13 which have the output-id PR5 attached and have last been referenced yesterday.SPACE           @PQCUP,UI   B12/QUEUE,B13/QUE,PR5/OUTPUT-ID,TE.1/REFAGE           @PQCUP,UI   B12,B13/Q,PR5/O,TE.1/REFAGE